{"ast":null,"code":"import*as tf from\"@tensorflow/tfjs\";export const detect=async(net,webcamRef,canvasRef,updateEngagementLevel)=>{if(typeof webcamRef.current!==\"undefined\"&&webcamRef.current!==null&&webcamRef.current.video.readyState===4){const video=webcamRef.current.video;const videoWidth=webcamRef.current.video.videoWidth;const videoHeight=webcamRef.current.video.videoHeight;webcamRef.current.video.width=videoWidth;webcamRef.current.video.height=videoHeight;canvasRef.current.width=videoWidth;canvasRef.current.height=videoHeight;const img=tf.browser.fromPixels(video);const resized=tf.image.resizeBilinear(img,[120,120]);const normalized=resized.div(tf.scalar(255.0));const casted=normalized.cast('float32');const expanded=casted.expandDims(0);const obj=await net.predict(expanded);const isFace=await obj[0].array();const isEngaged=await obj[1].array();const boxes=await obj[2].array();const ctx=canvasRef.current.getContext(\"2d\");requestAnimationFrame(()=>{drawRect(boxes[0],isFace[0],isEngaged[0],videoWidth,videoHeight,ctx,updateEngagementLevel);});tf.dispose(img);tf.dispose(resized);tf.dispose(normalized);tf.dispose(casted);tf.dispose(expanded);tf.dispose(obj);}};export const drawRect=(boxes,isFace,isEngaged,imgWidth,imgHeight,ctx,updateEngagementLevel,increment)=>{boxes[0]=boxes[0]*imgWidth;boxes[1]=boxes[1]*imgHeight;boxes[2]=boxes[2]*imgWidth;boxes[3]=boxes[3]*imgHeight;if(isFace[0]>0.7){const[x1,y1,x2,y2]=boxes;if(isEngaged[0]>0.9){updateEngagementLevel(1);ctx.strokeStyle='#32cd80';ctx.lineWidth=10;ctx.fillStyle='#f5f5f5';ctx.font='1.2em Staatliches';ctx.beginPath();ctx.fillText('Engaged: '+Math.round(isEngaged[0]*100)/100,x1,y1-10);ctx.rect(x1,y1,x2-x1,y2-y1);ctx.stroke();}else{updateEngagementLevel(-1);ctx.strokeStyle='#ff4d4d';ctx.lineWidth=10;ctx.fillStyle='#f5f5f5';ctx.font='1.2em Staatliches';ctx.beginPath();ctx.fillText('Not Engaged: '+Math.round((1-isEngaged[0])*100)/100,x1,y1-10);ctx.rect(x1,y1,x2-x1,y2-y1);ctx.stroke();}}else{updateEngagementLevel(-1);}};","map":{"version":3,"names":["tf","detect","net","webcamRef","canvasRef","updateEngagementLevel","current","video","readyState","videoWidth","videoHeight","width","height","img","browser","fromPixels","resized","image","resizeBilinear","normalized","div","scalar","casted","cast","expanded","expandDims","obj","predict","isFace","array","isEngaged","boxes","ctx","getContext","requestAnimationFrame","drawRect","dispose","imgWidth","imgHeight","increment","x1","y1","x2","y2","strokeStyle","lineWidth","fillStyle","font","beginPath","fillText","Math","round","rect","stroke"],"sources":["C:/Users/reddy/Documents/Projects/engagement-tracker-react/src/util/utilities.js"],"sourcesContent":["import * as tf from \"@tensorflow/tfjs\";\r\n\r\nexport const detect = async (net, webcamRef, canvasRef, updateEngagementLevel) => {\r\n    if (\r\n        typeof webcamRef.current !== \"undefined\" &&\r\n        webcamRef.current !== null &&\r\n        webcamRef.current.video.readyState === 4\r\n    ) {\r\n        const video = webcamRef.current.video;\r\n        const videoWidth = webcamRef.current.video.videoWidth;\r\n        const videoHeight = webcamRef.current.video.videoHeight;\r\n\r\n        webcamRef.current.video.width = videoWidth;\r\n        webcamRef.current.video.height = videoHeight;\r\n\r\n        canvasRef.current.width = videoWidth;\r\n        canvasRef.current.height = videoHeight;\r\n\r\n        const img = tf.browser.fromPixels(video)\r\n        const resized = tf.image.resizeBilinear(img, [120,120])\r\n        const normalized = resized.div(tf.scalar(255.0))\r\n        \r\n        const casted = normalized.cast('float32')\r\n        const expanded = casted.expandDims(0)\r\n\r\n        const obj = await net.predict(expanded)\r\n\r\n        const isFace = await obj[0].array()\r\n        const isEngaged = await obj[1].array()\r\n        const boxes = await obj[2].array()\r\n        \r\n        const ctx = canvasRef.current.getContext(\"2d\");\r\n\r\n        requestAnimationFrame(\r\n            () => {\r\n                drawRect(boxes[0], isFace[0], isEngaged[0], videoWidth, videoHeight, ctx, updateEngagementLevel)\r\n            }); \r\n\r\n        tf.dispose(img)\r\n        tf.dispose(resized)\r\n        tf.dispose(normalized)\r\n        tf.dispose(casted)\r\n        tf.dispose(expanded)\r\n        tf.dispose(obj)\r\n    }\r\n}\r\n\r\nexport const drawRect = (boxes, isFace, isEngaged, imgWidth, imgHeight, ctx, updateEngagementLevel, increment) => {\r\n    boxes[0] = boxes[0] * imgWidth\r\n    boxes[1] = boxes[1] * imgHeight\r\n    boxes[2] = boxes[2] * imgWidth\r\n    boxes[3] = boxes[3] * imgHeight\r\n\r\n    if(isFace[0] > 0.7){\r\n        const [x1, y1, x2, y2] = boxes\r\n        \r\n        if (isEngaged[0] > 0.9) {\r\n            updateEngagementLevel(1)\r\n\r\n            ctx.strokeStyle = '#32cd80'\r\n            ctx.lineWidth = 10\r\n            ctx.fillStyle = '#f5f5f5'\r\n            ctx.font = '1.2em Staatliches'         \r\n            \r\n            ctx.beginPath()\r\n            ctx.fillText('Engaged: ' + Math.round(isEngaged[0] * 100) / 100, x1, y1 - 10)\r\n            ctx.rect(x1, y1, (x2 - x1), (y2 - y1));\r\n            ctx.stroke()\r\n        } else {\r\n            updateEngagementLevel(-1)\r\n\r\n            ctx.strokeStyle = '#ff4d4d'\r\n            ctx.lineWidth = 10\r\n            ctx.fillStyle = '#f5f5f5'\r\n            ctx.font = '1.2em Staatliches'         \r\n            \r\n            ctx.beginPath()\r\n            ctx.fillText('Not Engaged: ' + Math.round((1 - isEngaged[0]) * 100) / 100, x1, y1 - 10)\r\n            ctx.rect(x1, y1, (x2 - x1), (y2 - y1));\r\n            ctx.stroke()\r\n        }\r\n    } else {\r\n        updateEngagementLevel(-1)\r\n    }\r\n}"],"mappings":"AAAA,MAAO,GAAK,CAAAA,EAAE,KAAM,kBAAkB,CAEtC,MAAO,MAAM,CAAAC,MAAM,CAAG,KAAAA,CAAOC,GAAG,CAAEC,SAAS,CAAEC,SAAS,CAAEC,qBAAqB,GAAK,CAC9E,GACI,MAAO,CAAAF,SAAS,CAACG,OAAO,GAAK,WAAW,EACxCH,SAAS,CAACG,OAAO,GAAK,IAAI,EAC1BH,SAAS,CAACG,OAAO,CAACC,KAAK,CAACC,UAAU,GAAK,CAAC,CAC1C,CACE,KAAM,CAAAD,KAAK,CAAGJ,SAAS,CAACG,OAAO,CAACC,KAAK,CACrC,KAAM,CAAAE,UAAU,CAAGN,SAAS,CAACG,OAAO,CAACC,KAAK,CAACE,UAAU,CACrD,KAAM,CAAAC,WAAW,CAAGP,SAAS,CAACG,OAAO,CAACC,KAAK,CAACG,WAAW,CAEvDP,SAAS,CAACG,OAAO,CAACC,KAAK,CAACI,KAAK,CAAGF,UAAU,CAC1CN,SAAS,CAACG,OAAO,CAACC,KAAK,CAACK,MAAM,CAAGF,WAAW,CAE5CN,SAAS,CAACE,OAAO,CAACK,KAAK,CAAGF,UAAU,CACpCL,SAAS,CAACE,OAAO,CAACM,MAAM,CAAGF,WAAW,CAEtC,KAAM,CAAAG,GAAG,CAAGb,EAAE,CAACc,OAAO,CAACC,UAAU,CAACR,KAAK,CAAC,CACxC,KAAM,CAAAS,OAAO,CAAGhB,EAAE,CAACiB,KAAK,CAACC,cAAc,CAACL,GAAG,CAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CACvD,KAAM,CAAAM,UAAU,CAAGH,OAAO,CAACI,GAAG,CAACpB,EAAE,CAACqB,MAAM,CAAC,KAAK,CAAC,CAAC,CAEhD,KAAM,CAAAC,MAAM,CAAGH,UAAU,CAACI,IAAI,CAAC,SAAS,CAAC,CACzC,KAAM,CAAAC,QAAQ,CAAGF,MAAM,CAACG,UAAU,CAAC,CAAC,CAAC,CAErC,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAxB,GAAG,CAACyB,OAAO,CAACH,QAAQ,CAAC,CAEvC,KAAM,CAAAI,MAAM,CAAG,KAAM,CAAAF,GAAG,CAAC,CAAC,CAAC,CAACG,KAAK,CAAC,CAAC,CACnC,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAJ,GAAG,CAAC,CAAC,CAAC,CAACG,KAAK,CAAC,CAAC,CACtC,KAAM,CAAAE,KAAK,CAAG,KAAM,CAAAL,GAAG,CAAC,CAAC,CAAC,CAACG,KAAK,CAAC,CAAC,CAElC,KAAM,CAAAG,GAAG,CAAG5B,SAAS,CAACE,OAAO,CAAC2B,UAAU,CAAC,IAAI,CAAC,CAE9CC,qBAAqB,CACjB,IAAM,CACFC,QAAQ,CAACJ,KAAK,CAAC,CAAC,CAAC,CAAEH,MAAM,CAAC,CAAC,CAAC,CAAEE,SAAS,CAAC,CAAC,CAAC,CAAErB,UAAU,CAAEC,WAAW,CAAEsB,GAAG,CAAE3B,qBAAqB,CAAC,CACpG,CAAC,CAAC,CAENL,EAAE,CAACoC,OAAO,CAACvB,GAAG,CAAC,CACfb,EAAE,CAACoC,OAAO,CAACpB,OAAO,CAAC,CACnBhB,EAAE,CAACoC,OAAO,CAACjB,UAAU,CAAC,CACtBnB,EAAE,CAACoC,OAAO,CAACd,MAAM,CAAC,CAClBtB,EAAE,CAACoC,OAAO,CAACZ,QAAQ,CAAC,CACpBxB,EAAE,CAACoC,OAAO,CAACV,GAAG,CAAC,CACnB,CACJ,CAAC,CAED,MAAO,MAAM,CAAAS,QAAQ,CAAGA,CAACJ,KAAK,CAAEH,MAAM,CAAEE,SAAS,CAAEO,QAAQ,CAAEC,SAAS,CAAEN,GAAG,CAAE3B,qBAAqB,CAAEkC,SAAS,GAAK,CAC9GR,KAAK,CAAC,CAAC,CAAC,CAAGA,KAAK,CAAC,CAAC,CAAC,CAAGM,QAAQ,CAC9BN,KAAK,CAAC,CAAC,CAAC,CAAGA,KAAK,CAAC,CAAC,CAAC,CAAGO,SAAS,CAC/BP,KAAK,CAAC,CAAC,CAAC,CAAGA,KAAK,CAAC,CAAC,CAAC,CAAGM,QAAQ,CAC9BN,KAAK,CAAC,CAAC,CAAC,CAAGA,KAAK,CAAC,CAAC,CAAC,CAAGO,SAAS,CAE/B,GAAGV,MAAM,CAAC,CAAC,CAAC,CAAG,GAAG,CAAC,CACf,KAAM,CAACY,EAAE,CAAEC,EAAE,CAAEC,EAAE,CAAEC,EAAE,CAAC,CAAGZ,KAAK,CAE9B,GAAID,SAAS,CAAC,CAAC,CAAC,CAAG,GAAG,CAAE,CACpBzB,qBAAqB,CAAC,CAAC,CAAC,CAExB2B,GAAG,CAACY,WAAW,CAAG,SAAS,CAC3BZ,GAAG,CAACa,SAAS,CAAG,EAAE,CAClBb,GAAG,CAACc,SAAS,CAAG,SAAS,CACzBd,GAAG,CAACe,IAAI,CAAG,mBAAmB,CAE9Bf,GAAG,CAACgB,SAAS,CAAC,CAAC,CACfhB,GAAG,CAACiB,QAAQ,CAAC,WAAW,CAAGC,IAAI,CAACC,KAAK,CAACrB,SAAS,CAAC,CAAC,CAAC,CAAG,GAAG,CAAC,CAAG,GAAG,CAAEU,EAAE,CAAEC,EAAE,CAAG,EAAE,CAAC,CAC7ET,GAAG,CAACoB,IAAI,CAACZ,EAAE,CAAEC,EAAE,CAAGC,EAAE,CAAGF,EAAE,CAAIG,EAAE,CAAGF,EAAG,CAAC,CACtCT,GAAG,CAACqB,MAAM,CAAC,CAAC,CAChB,CAAC,IAAM,CACHhD,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAEzB2B,GAAG,CAACY,WAAW,CAAG,SAAS,CAC3BZ,GAAG,CAACa,SAAS,CAAG,EAAE,CAClBb,GAAG,CAACc,SAAS,CAAG,SAAS,CACzBd,GAAG,CAACe,IAAI,CAAG,mBAAmB,CAE9Bf,GAAG,CAACgB,SAAS,CAAC,CAAC,CACfhB,GAAG,CAACiB,QAAQ,CAAC,eAAe,CAAGC,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,CAAGrB,SAAS,CAAC,CAAC,CAAC,EAAI,GAAG,CAAC,CAAG,GAAG,CAAEU,EAAE,CAAEC,EAAE,CAAG,EAAE,CAAC,CACvFT,GAAG,CAACoB,IAAI,CAACZ,EAAE,CAAEC,EAAE,CAAGC,EAAE,CAAGF,EAAE,CAAIG,EAAE,CAAGF,EAAG,CAAC,CACtCT,GAAG,CAACqB,MAAM,CAAC,CAAC,CAChB,CACJ,CAAC,IAAM,CACHhD,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAC7B,CACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}